!function(e){var t={};function s(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(r,n,function(t){return e[t]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";s.r(t);class r{constructor(){this._username="",this._password=""}set username(e){this._username=e}set password(e){this._password=e}}const n={username:/^[a-zA-Z\d.]{6,}$/,password:/^(?!.*?[\^])(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$/,confirmed:/^(?!.*?[\^])(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$/,email:/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/};class o{constructor(e){this.dbName=e,this.addUser=e=>new Promise((t,s)=>{this.usernameExists(e.username).then(t=>{if(t)console.log("Err: Username already exists.");else{const t=this.db.transaction(["users"],"readwrite").objectStore("users").add(e);t.onsuccess=function(e){console.log("User added!")},t.onerror=function(e){}}})}),this.usernameExists=e=>new Promise((t,s)=>{this.db.transaction(["users"]).objectStore("users").openCursor().onsuccess=s=>{let r=s.target.result;r?r.value.username===e&&!1===r.value.deleted?t(!0):r.continue():t(!1)}}),this.verifyLoginInfo=e=>new Promise((t,s)=>{this.db.transaction(["users"]).objectStore("users").openCursor().onsuccess=s=>{let r=s.target.result;r?r.value.username===e.username&&!1===r.value.deleted?r.value.password===e.password?t(0):t(-1):r.continue():t(-2)}}),this.addNote=e=>{},this.deleteNote=e=>{},this.completeNote=e=>{},this.listNotes=e=>{},this.addCategory=e=>{},this.IndxDb=window.indexedDB,this.db={},this.openDB()}openDB(){return new Promise((e,t)=>{let s;(s=this.IndxDb.open(this.dbName)).onupgradeneeded=e=>{this.db=e.target.result,this.db.createObjectStore("users",{keyPath:"id",autoIncrement:!0}),this.db.createObjectStore("list",{keyPath:"id"}),this.db.createObjectStore("category",{keyPath:"id",autoIncrement:!0}),console.log("Database was set up successfully")},s.onsuccess=t=>{e(this.db=t.target.result)},s.onerror=()=>{t(console.log("Database failed to open"))}})}}const a=document.querySelector("#loginUsername"),i=document.querySelector("#loginPassword"),d=document.querySelector(".form-index"),u=document.querySelector(".login-error");let l=new o("database1");const c=new class extends r{constructor(){super()}submitForm(){return{username:this._username,password:this._password}}};function m(e){"loginUsername"===e.id?c.username=e.value:"loginPassword"===e.id&&(c.password=e.value)}a&&a.addEventListener("blur",()=>{m(a)}),i&&i.addEventListener("blur",()=>{m(i)}),d&&d.addEventListener("submit",e=>{e.preventDefault(),l.verifyLoginInfo(c.submitForm()).then(e=>{!function(e){0===e?u.innerText="":-1===e?u.innerText="wrong password":-2===e&&(u.innerText="username does not exist")}(e),0===e&&sessionStorage.setItem("login-token","valid")})});const h=document.querySelector("#username"),f=document.querySelector("#password"),p=document.querySelector("#confirmed"),b=document.querySelector("#email"),v=document.querySelector(".form-registration"),y=document.querySelector("#submit"),w=document.querySelector(".pass-match");let g=new o("database1");const _=new class extends r{constructor(){super(),this._confirmed="",this._email=""}set confirmed(e){this._confirmed=e}set email(e){this._email=e}validateInput(e,t){return n[e].test(t)}checkPasswordMatch(){return this._password===this._confirmed}validateForm(){return""!==this._username&&""!==this._password&&""!==this._confirmed&&""!==this._email&&this.checkPasswordMatch()}submitForm(){return{username:this._username,password:this._password,email:this._email,deleted:!1}}};function S(e){let t=_.validateInput(e.id,e.value);try{if(!t)throw"Invalid Input"}catch(t){e.className="form-control is-invalid"}finally{"username"===e.id?_.username=t?e.value:"":"password"===e.id?_.password=t?e.value:"":"confirmed"===e.id?_.confirmed=t?e.value:"":"email"===e.id&&(_.email=t?e.value:""),t&&(e.className="form-control is-valid"),_.validateForm()?(y.disabled=!1,w.style.display="none"):(y.disabled=!0,_.checkPasswordMatch()?w.style.display="none":w.style.display="block")}}h&&h.addEventListener("blur",()=>{S(h)}),f&&f.addEventListener("blur",()=>{S(f)}),p&&p.addEventListener("blur",()=>{S(p)}),b&&b.addEventListener("blur",()=>{S(b)}),v&&v.addEventListener("submit",e=>{e.preventDefault(),g.addUser(_.submitForm()).then(e=>{console.log(e)}).catch()})}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL3V0aWxzLnRzIiwid2VicGFjazovLy8uL3NyYy9kYXRhYmFzZS50cyIsIndlYnBhY2s6Ly8vLi9zcmMvbG9naW4udHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3JlZ2lzdHJhdGlvbi50cyJdLCJuYW1lcyI6WyJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIkF1dGhlbnRpY2F0aW9uIiwidGhpcyIsIl91c2VybmFtZSIsIl9wYXNzd29yZCIsImlucHV0VmFsaWRhdGlvblJlZ2V4IiwidXNlcm5hbWUiLCJwYXNzd29yZCIsImNvbmZpcm1lZCIsImVtYWlsIiwiRGF0YWJhc2UiLCJkYk5hbWUiLCJhZGRVc2VyIiwibmV3VXNlciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwidXNlcm5hbWVFeGlzdHMiLCJ0aGVuIiwiZXhpc3RzIiwiY29uc29sZSIsImxvZyIsInJlcXVlc3QiLCJkYiIsInRyYW5zYWN0aW9uIiwib2JqZWN0U3RvcmUiLCJhZGQiLCJvbnN1Y2Nlc3MiLCJlIiwib25lcnJvciIsIm9wZW5DdXJzb3IiLCJjdXJzb3IiLCJ0YXJnZXQiLCJyZXN1bHQiLCJkZWxldGVkIiwiY29udGludWUiLCJ2ZXJpZnlMb2dpbkluZm8iLCJ1c2VySW5mbyIsImFkZE5vdGUiLCJub3RlVGV4dCIsImRlbGV0ZU5vdGUiLCJpZCIsImNvbXBsZXRlTm90ZSIsImxpc3ROb3RlcyIsImNhdGVnb3J5TmFtZSIsImFkZENhdGVnb3J5IiwiSW5keERiIiwid2luZG93IiwiaW5kZXhlZERCIiwib3BlbkRCIiwicmVxIiwib3BlbiIsIm9udXBncmFkZW5lZWRlZCIsImNyZWF0ZU9iamVjdFN0b3JlIiwia2V5UGF0aCIsImF1dG9JbmNyZW1lbnQiLCJsb2dpblVzZXJuYW1lIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwibG9naW5QYXNzd29yZCIsImxvZ2luRm9ybSIsImxvZ2luRXJyb3IiLCJ1c2VyIiwic3VwZXIiLCJnZXRJbnB1dCIsImVsZW0iLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJwcmV2ZW50RGVmYXVsdCIsInN1Ym1pdEZvcm0iLCJyZXNwIiwiZmxhZyIsImlubmVyVGV4dCIsImhhbmRsZUlucHV0cyIsInNlc3Npb25TdG9yYWdlIiwic2V0SXRlbSIsInVzZXJuYW1lSW5wdXQiLCJwYXNzd29yZElucHV0IiwiY29uZmlybVB3SW5wdXQiLCJlbWFpbElucHV0Iiwic3VibWl0QnV0dG9uIiwicGFzc3dvcmRNYXRjaFBhcmFncmFwaCIsIl9jb25maXJtZWQiLCJfZW1haWwiLCJ0ZXN0IiwiY2hlY2tQYXNzd29yZE1hdGNoIiwidmFsaWRhdGVGaWVsZCIsInZhbGlkIiwidmFsaWRhdGVJbnB1dCIsImVyciIsImNsYXNzTmFtZSIsInZhbGlkYXRlRm9ybSIsImRpc2FibGVkIiwic3R5bGUiLCJkaXNwbGF5IiwicmVzcG9uc2UiLCJjYXRjaCJdLCJtYXBwaW5ncyI6ImFBQ0UsSUFBSUEsRUFBbUIsR0FHdkIsU0FBU0MsRUFBb0JDLEdBRzVCLEdBQUdGLEVBQWlCRSxHQUNuQixPQUFPRixFQUFpQkUsR0FBVUMsUUFHbkMsSUFBSUMsRUFBU0osRUFBaUJFLEdBQVksQ0FDekNHLEVBQUdILEVBQ0hJLEdBQUcsRUFDSEgsUUFBUyxJQVVWLE9BTkFJLEVB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USxLQUFRb0IsRUFBY1YsS0FDNUVDLEdBQWVBLEVBQWNYLGlCQUFpQixPQUFRLEtBQVFvQixFQUFjVCxLQUM1RUMsR0FBZ0JBLEVBQWVaLGlCQUFpQixPQUFRLEtBQVFvQixFQUFjUixLQUM5RUMsR0FBWUEsRUFBV2IsaUJBQWlCLE9BQVEsS0FBUW9CLEVBQWNQLEtBRXRFLEdBQ0YsRUFBS2IsaUJBQWlCLFNBQVdDLElBQy9CQSxFQUFNQyxpQkFFTixFQUFHeEQsUUFBUSxFQUFLeUQsY0FDYm5ELEtBQU02RSxJQUNMM0UsUUFBUUMsSUFBSTBFLEtBRWJDIiwiZmlsZSI6ImJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbiIsImNsYXNzIEF1dGhlbnRpY2F0aW9uIHtcclxuICBwcm90ZWN0ZWQgX3VzZXJuYW1lOiBzdHJpbmc7XHJcbiAgcHJvdGVjdGVkIF9wYXNzd29yZDogc3RyaW5nO1xyXG5cclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHRoaXMuX3VzZXJuYW1lID0gJyc7XHJcbiAgICB0aGlzLl9wYXNzd29yZCA9ICcnO1xyXG4gIH1cclxuXHJcbiAgc2V0IHVzZXJuYW1lKHZhbHVlOiBzdHJpbmcpIHsgdGhpcy5fdXNlcm5hbWUgPSB2YWx1ZTsgfTtcclxuICBzZXQgcGFzc3dvcmQodmFsdWU6IHN0cmluZykgeyB0aGlzLl9wYXNzd29yZCA9IHZhbHVlOyB9O1xyXG59XHJcblxyXG5pbnRlcmZhY2UgSVVzZXIge1xyXG4gIHVzZXJuYW1lOiBzdHJpbmcsXHJcbiAgcGFzc3dvcmQ6IHN0cmluZyxcclxuICBlbWFpbDogc3RyaW5nLFxyXG4gIGRlbGV0ZWQ6IGJvb2xlYW5cclxufVxyXG5cclxuaW50ZXJmYWNlIElMb2dpbiB7XHJcbiAgdXNlcm5hbWU6IHN0cmluZyxcclxuICBwYXNzd29yZDogc3RyaW5nXHJcbn1cclxuXHJcbmludGVyZmFjZSBJT3B0aW9ucyB7XHJcbiAgW29wdGlvbjogc3RyaW5nXTogUmVnRXhwO1xyXG59O1xyXG5cclxuY29uc3QgaW5wdXRWYWxpZGF0aW9uUmVnZXg6IElPcHRpb25zID0ge1xyXG4gIHVzZXJuYW1lOiAvXlthLXpBLVpcXGQuXXs2LH0kLyxcclxuICBwYXNzd29yZDogL14oPyEuKj9bXFxeXSkoPz0uKlthLXpdKSg/PS4qW0EtWl0pKD89LipcXGQpLns4LH0kLyxcclxuICBjb25maXJtZWQ6IC9eKD8hLio/W1xcXl0pKD89LipbYS16XSkoPz0uKltBLVpdKSg/PS4qXFxkKS57OCx9JC8sXHJcbiAgZW1haWw6IC9eKChbXjw+KClcXFtcXF1cXFxcLiw7Olxcc0BcIl0rKFxcLltePD4oKVxcW1xcXVxcXFwuLDs6XFxzQFwiXSspKil8KFwiLitcIikpQCgoXFxbWzAtOV17MSwzfVxcLlswLTldezEsM31cXC5bMC05XXsxLDN9XFwuWzAtOV17MSwzfVxcXSl8KChbYS16QS1aXFwtMC05XStcXC4pK1thLXpBLVpdezIsfSkpJC9cclxufTtcclxuXHJcbmV4cG9ydCB7XHJcbiAgQXV0aGVudGljYXRpb24sXHJcbiAgSVVzZXIsXHJcbiAgSUxvZ2luLFxyXG4gIGlucHV0VmFsaWRhdGlvblJlZ2V4XHJcbn1cclxuIiwiaW1wb3J0IHsgSVVzZXIsIElMb2dpbiB9IGZyb20gJy4vdXRpbHMnO1xyXG5cclxuY2xhc3MgRGF0YWJhc2Uge1xyXG4gIHByaXZhdGUgSW5keERiOiBJREJGYWN0b3J5O1xyXG4gIHByaXZhdGUgZGI6IElEQkRhdGFiYXNlO1xyXG5cclxuICBjb25zdHJ1Y3RvcihwdWJsaWMgZGJOYW1lOiBzdHJpbmcpIHtcclxuICAgIHRoaXMuSW5keERiID0gd2luZG93LmluZGV4ZWREQjtcclxuICAgIHRoaXMuZGIgPSB7fSBhcyBJREJEYXRhYmFzZTtcclxuICAgIHRoaXMub3BlbkRCKCk7XHJcbiAgfVxyXG5cclxuICAvLyBPcGVuIGRhdGFiYXNlIG9uIGNsYXNzIGluc3RhbnRpYXRpb25cclxuICBvcGVuREIoKSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICBsZXQgcmVxOiBJREJPcGVuREJSZXF1ZXN0O1xyXG4gICAgICByZXEgPSB0aGlzLkluZHhEYi5vcGVuKHRoaXMuZGJOYW1lKTtcclxuXHJcbiAgICAgIC8vIFNldCB1cCB0aGUgb2JqZWN0IHN0b3JlIGlmIG5ldyBkYXRhYmFzZVxyXG4gICAgICByZXEub251cGdyYWRlbmVlZGVkID0gKGU6IGFueSkgPT4ge1xyXG4gICAgICAgIHRoaXMuZGIgPSBlLnRhcmdldC5yZXN1bHQ7XHJcblxyXG4gICAgICAgIHRoaXMuZGIuY3JlYXRlT2JqZWN0U3RvcmUoXCJ1c2Vyc1wiLCB7IGtleVBhdGg6ICdpZCcsIGF1dG9JbmNyZW1lbnQ6IHRydWUgfSk7XHJcbiAgICAgICAgdGhpcy5kYi5jcmVhdGVPYmplY3RTdG9yZShcImxpc3RcIiwgeyBrZXlQYXRoOiAnaWQnIH0pO1xyXG4gICAgICAgIHRoaXMuZGIuY3JlYXRlT2JqZWN0U3RvcmUoXCJjYXRlZ29yeVwiLCB7IGtleVBhdGg6ICdpZCcsIGF1dG9JbmNyZW1lbnQ6IHRydWUgfSk7XHJcblxyXG4gICAgICAgIGNvbnNvbGUubG9nKCdEYXRhYmFzZSB3YXMgc2V0IHVwIHN1Y2Nlc3NmdWxseScpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICByZXEub25zdWNjZXNzID0gKGU6IGFueSkgPT4ge1xyXG4gICAgICAgIHJlc29sdmUodGhpcy5kYiA9IGUudGFyZ2V0LnJlc3VsdCk7XHJcbiAgICAgIH1cclxuICAgICAgcmVxLm9uZXJyb3IgPSAoKSA9PiB7XHJcbiAgICAgICAgcmVqZWN0KGNvbnNvbGUubG9nKCdEYXRhYmFzZSBmYWlsZWQgdG8gb3BlbicpKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcblx0LyoqXHJcblx0ICogIFRSQU5TQUNUSU9OUyBcclxuXHQgKi9cclxuICBhZGRVc2VyID0gKG5ld1VzZXI6IElVc2VyKSA9PiB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICB0aGlzLnVzZXJuYW1lRXhpc3RzKG5ld1VzZXIudXNlcm5hbWUpXHJcbiAgICAgICAgLnRoZW4oKGV4aXN0cykgPT4ge1xyXG4gICAgICAgICAgaWYgKCFleGlzdHMpIHtcclxuICAgICAgICAgICAgY29uc3QgcmVxdWVzdCA9IHRoaXMuZGIudHJhbnNhY3Rpb24oW1widXNlcnNcIl0sIFwicmVhZHdyaXRlXCIpXHJcbiAgICAgICAgICAgICAgLm9iamVjdFN0b3JlKFwidXNlcnNcIilcclxuICAgICAgICAgICAgICAuYWRkKG5ld1VzZXIpO1xyXG5cclxuICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbiAoZTogYW55KSB7XHJcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJVc2VyIGFkZGVkIVwiKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgcmVxdWVzdC5vbmVycm9yID0gZnVuY3Rpb24gKGU6IGFueSkge1xyXG4gICAgICAgICAgICAgIC8vIGhhbmRsZSBlcnJvclxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkVycjogVXNlcm5hbWUgYWxyZWFkeSBleGlzdHMuXCIpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICB1c2VybmFtZUV4aXN0cyA9ICh1c2VybmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICB0aGlzLmRiLnRyYW5zYWN0aW9uKFtcInVzZXJzXCJdKVxyXG4gICAgICAgIC5vYmplY3RTdG9yZShcInVzZXJzXCIpXHJcbiAgICAgICAgLm9wZW5DdXJzb3IoKS5vbnN1Y2Nlc3MgPSAoZTogYW55KSA9PiB7XHJcbiAgICAgICAgICBsZXQgY3Vyc29yID0gZS50YXJnZXQucmVzdWx0IGFzIElEQkN1cnNvcldpdGhWYWx1ZTtcclxuICAgICAgICAgIGlmIChjdXJzb3IpIHtcclxuICAgICAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICAgIGN1cnNvci52YWx1ZS51c2VybmFtZSA9PT0gdXNlcm5hbWUgJiZcclxuICAgICAgICAgICAgICBjdXJzb3IudmFsdWUuZGVsZXRlZCA9PT0gZmFsc2VcclxuICAgICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgICAgcmVzb2x2ZSh0cnVlKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICBjdXJzb3IuY29udGludWUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmVzb2x2ZShmYWxzZSk7IC8vIG5vIG1vcmUgZW50cmllc1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gIHZlcmlmeUxvZ2luSW5mbyA9ICh1c2VySW5mbzogSUxvZ2luKSA9PiB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICB0aGlzLmRiLnRyYW5zYWN0aW9uKFtcInVzZXJzXCJdKVxyXG4gICAgICAgIC5vYmplY3RTdG9yZShcInVzZXJzXCIpXHJcbiAgICAgICAgLm9wZW5DdXJzb3IoKS5vbnN1Y2Nlc3MgPSAoZTogYW55KSA9PiB7XHJcbiAgICAgICAgICBsZXQgY3Vyc29yID0gZS50YXJnZXQucmVzdWx0IGFzIElEQkN1cnNvcldpdGhWYWx1ZTtcclxuICAgICAgICAgIGlmIChjdXJzb3IpIHtcclxuICAgICAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICAgIGN1cnNvci52YWx1ZS51c2VybmFtZSA9PT0gdXNlckluZm8udXNlcm5hbWUgJiZcclxuICAgICAgICAgICAgICBjdXJzb3IudmFsdWUuZGVsZXRlZCA9PT0gZmFsc2VcclxuICAgICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgICAgaWYgKGN1cnNvci52YWx1ZS5wYXNzd29yZCA9PT0gdXNlckluZm8ucGFzc3dvcmQpIHtcclxuICAgICAgICAgICAgICAgIHJlc29sdmUoMCk7IC8vIGxvZ2luIHN1Y2Nlc2Z1bFxyXG4gICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKC0xKTsgLy8gd3JvbmcgcGFzc3dvcmRcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgY3Vyc29yLmNvbnRpbnVlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJlc29sdmUoLTIpOyAvLyB1c2VybmFtZSBkb2VzIG5vdCBleGlzdFxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG5cdC8qKiBQUk9UT1RZUEVTIGZvciBub3RlIGhhbmRsaW5nXHJcblx0ICogIGFkZE5vdGUgLSBhZGRzIHRleHQgZnJvbSBpbnB1dCBmaWVsZFxyXG5cdCAqICBkZWxldGVOb3RlIC0gZGVsZXRlcyBub3RlIGJhc2VkIG9uIG5vdGUgaWRcclxuXHQgKiAgY29tcGxldGVOb3RlIC0gY29tcGxldGUgbm90ZSBiYXNlZCBvbiBub3RlIGlkIChjaGFuZ2UgY29tcGxldGVkIGZpZWxkIG9mIG5vdGUpXHJcblx0ICogIGxpc3ROb3RlcyAtIGxpc3Qgbm90ZXMgYmFzZWQgb24gY2F0ZWdvcmllcyAoYWxsLCB4LCB5LCB6KVxyXG5cdCAqIFxyXG5cdCAqICBvbmx5IGxpc3Qgbm90ZXMgdGhhdCBkbyBub3QgaGF2ZSBmaWVsZCAnZGVsZXRlZCA9IHRydWUnXHJcblx0ICovXHJcbiAgYWRkTm90ZSA9IChub3RlVGV4dDogc3RyaW5nKSA9PiB7IH07XHJcbiAgZGVsZXRlTm90ZSA9IChpZDogbnVtYmVyKSA9PiB7IH07XHJcbiAgY29tcGxldGVOb3RlID0gKGlkOiBudW1iZXIpID0+IHsgfTtcclxuICBsaXN0Tm90ZXMgPSAoY2F0ZWdvcnlOYW1lOiBzdHJpbmcpID0+IHsgfTtcclxuXHJcblx0LyoqXHJcblx0ICogIFBST1RPVFlQRVMgZm9yIGNhdGVnb3J5IGhhbmRsaW5nXHJcblx0ICovXHJcbiAgYWRkQ2F0ZWdvcnkgPSAoY2F0ZWdvcnlOYW1lOiBzdHJpbmcpID0+IHtcclxuICAgIGxldCBkZWZhdWx0Q2F0ZWc7IC8vIGNoZWNrIGlmIHRoZSBkZWZhdWx0IGNhdGVnb3J5IGV4aXN0c1xyXG4gICAgaWYgKCFkZWZhdWx0Q2F0ZWcpIHsgLy8gY3JlYXRlIGl0IGlmIGl0IGRvZXNuJ3RcclxuICAgICAgLy8gY3JlYXRlIGRlZmF1bHQgY2F0ZWdcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIC8vIGhhbmRsZSBhZGRpbmcgbmV3IGNhdGVnb3J5XHJcbiAgICB9XHJcbiAgfTtcclxufVxyXG5cclxuZXhwb3J0IHsgRGF0YWJhc2UgfTtcclxuIiwiaW1wb3J0IHsgQXV0aGVudGljYXRpb24sIElMb2dpbiB9IGZyb20gJy4vdXRpbHMnXHJcbmltcG9ydCB7IERhdGFiYXNlIH0gZnJvbSAnLi9kYXRhYmFzZSc7XHJcblxyXG5jb25zdCBsb2dpblVzZXJuYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2xvZ2luVXNlcm5hbWUnKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xyXG5jb25zdCBsb2dpblBhc3N3b3JkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2xvZ2luUGFzc3dvcmQnKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xyXG5jb25zdCBsb2dpbkZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZm9ybS1pbmRleCcpIGFzIEhUTUxGb3JtRWxlbWVudDtcclxuY29uc3QgbG9naW5FcnJvciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5sb2dpbi1lcnJvcicpIGFzIEhUTUxFbGVtZW50O1xyXG5cclxuY2xhc3MgTG9naW4gZXh0ZW5kcyBBdXRoZW50aWNhdGlvbiB7XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICBzdXBlcigpO1xyXG4gIH1cclxuXHJcbiAgc3VibWl0Rm9ybSgpOiBJTG9naW4ge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgdXNlcm5hbWU6IHRoaXMuX3VzZXJuYW1lLFxyXG4gICAgICBwYXNzd29yZDogdGhpcy5fcGFzc3dvcmQsXHJcbiAgICB9O1xyXG4gIH07XHJcbn1cclxuXHJcbmxldCBkYiA9IG5ldyBEYXRhYmFzZSgnZGF0YWJhc2UxJyk7XHJcbmNvbnN0IHVzZXIgPSBuZXcgTG9naW47XHJcblxyXG5pZiAobG9naW5Vc2VybmFtZSkgbG9naW5Vc2VybmFtZS5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgKCkgPT4geyBnZXRJbnB1dChsb2dpblVzZXJuYW1lKSB9KTtcclxuaWYgKGxvZ2luUGFzc3dvcmQpIGxvZ2luUGFzc3dvcmQuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsICgpID0+IHsgZ2V0SW5wdXQobG9naW5QYXNzd29yZCkgfSk7XHJcblxyXG5pZiAobG9naW5Gb3JtKSB7XHJcbiAgbG9naW5Gb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIChldmVudCkgPT4ge1xyXG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICBkYi52ZXJpZnlMb2dpbkluZm8odXNlci5zdWJtaXRGb3JtKCkpXHJcbiAgICAgIC50aGVuKChyZXNwKSA9PiB7XHJcbiAgICAgICAgaGFuZGxlSW5wdXRzKHJlc3AgYXMgTnVtYmVyKTtcclxuICAgICAgICBpZiAocmVzcCA9PT0gMCkge1xyXG4gICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgnbG9naW4tdG9rZW4nLCAndmFsaWQnKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gIH0pO1xyXG5cclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0SW5wdXQoZWxlbTogSFRNTElucHV0RWxlbWVudCkge1xyXG4gIGlmIChlbGVtLmlkID09PSAnbG9naW5Vc2VybmFtZScpIHVzZXIudXNlcm5hbWUgPSBlbGVtLnZhbHVlO1xyXG4gIGVsc2UgaWYgKGVsZW0uaWQgPT09ICdsb2dpblBhc3N3b3JkJykgdXNlci5wYXNzd29yZCA9IGVsZW0udmFsdWU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUlucHV0cyhmbGFnOiBOdW1iZXIpIHtcclxuICBpZiAoZmxhZyA9PT0gMCkge1xyXG4gICAgbG9naW5FcnJvci5pbm5lclRleHQgPSAnJztcclxuICB9IGVsc2UgaWYgKGZsYWcgPT09IC0xKSB7XHJcbiAgICBsb2dpbkVycm9yLmlubmVyVGV4dCA9ICd3cm9uZyBwYXNzd29yZCc7XHJcbiAgfSBlbHNlIGlmIChmbGFnID09PSAtMikge1xyXG4gICAgbG9naW5FcnJvci5pbm5lclRleHQgPSAndXNlcm5hbWUgZG9lcyBub3QgZXhpc3QnO1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgeyBBdXRoZW50aWNhdGlvbiwgSVVzZXIsIGlucHV0VmFsaWRhdGlvblJlZ2V4IH0gZnJvbSAnLi91dGlscydcclxuaW1wb3J0IHsgRGF0YWJhc2UgfSBmcm9tICcuL2RhdGFiYXNlJztcclxuXHJcbmNvbnN0IHVzZXJuYW1lSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjdXNlcm5hbWUnKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xyXG5jb25zdCBwYXNzd29yZElucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3Bhc3N3b3JkJykgYXMgSFRNTElucHV0RWxlbWVudDtcclxuY29uc3QgY29uZmlybVB3SW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjY29uZmlybWVkJykgYXMgSFRNTElucHV0RWxlbWVudDtcclxuY29uc3QgZW1haWxJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNlbWFpbCcpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XHJcbmNvbnN0IGZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZm9ybS1yZWdpc3RyYXRpb24nKSBhcyBIVE1MRm9ybUVsZW1lbnQ7XHJcbmNvbnN0IHN1Ym1pdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNzdWJtaXQnKSBhcyBIVE1MRm9ybUVsZW1lbnQ7XHJcbmNvbnN0IHBhc3N3b3JkTWF0Y2hQYXJhZ3JhcGggPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucGFzcy1tYXRjaCcpIGFzIEhUTUxFbGVtZW50O1xyXG5cclxuY2xhc3MgUmVnaXN0cmF0aW9uIGV4dGVuZHMgQXV0aGVudGljYXRpb24ge1xyXG4gIHByb3RlY3RlZCBfY29uZmlybWVkOiBzdHJpbmc7XHJcbiAgcHJvdGVjdGVkIF9lbWFpbDogc3RyaW5nO1xyXG5cclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHN1cGVyKCk7XHJcbiAgICB0aGlzLl9jb25maXJtZWQgPSAnJztcclxuICAgIHRoaXMuX2VtYWlsID0gJyc7XHJcbiAgfTtcclxuXHJcbiAgc2V0IGNvbmZpcm1lZCh2YWx1ZTogc3RyaW5nKSB7IHRoaXMuX2NvbmZpcm1lZCA9IHZhbHVlOyB9O1xyXG4gIHNldCBlbWFpbCh2YWx1ZTogc3RyaW5nKSB7IHRoaXMuX2VtYWlsID0gdmFsdWU7IH07XHJcblxyXG4gIHZhbGlkYXRlSW5wdXQoa2V5OiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcpOiBCb29sZWFuIHtcclxuICAgIHJldHVybiBpbnB1dFZhbGlkYXRpb25SZWdleFtrZXldLnRlc3QodmFsdWUpO1xyXG4gIH07XHJcblxyXG4gIGNoZWNrUGFzc3dvcmRNYXRjaCgpOiBCb29sZWFuIHtcclxuICAgIHJldHVybiAodGhpcy5fcGFzc3dvcmQgPT09IHRoaXMuX2NvbmZpcm1lZCk7XHJcbiAgfVxyXG5cclxuICB2YWxpZGF0ZUZvcm0oKTogQm9vbGVhbiB7XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICB0aGlzLl91c2VybmFtZSAhPT0gJycgJiZcclxuICAgICAgdGhpcy5fcGFzc3dvcmQgIT09ICcnICYmXHJcbiAgICAgIHRoaXMuX2NvbmZpcm1lZCAhPT0gJycgJiZcclxuICAgICAgdGhpcy5fZW1haWwgIT09ICcnICYmXHJcbiAgICAgIHRoaXMuY2hlY2tQYXNzd29yZE1hdGNoKClcclxuICAgICk7XHJcbiAgfTtcclxuXHJcbiAgc3VibWl0Rm9ybSgpOiBJVXNlciB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB1c2VybmFtZTogdGhpcy5fdXNlcm5hbWUsXHJcbiAgICAgIHBhc3N3b3JkOiB0aGlzLl9wYXNzd29yZCxcclxuICAgICAgZW1haWw6IHRoaXMuX2VtYWlsLFxyXG4gICAgICBkZWxldGVkOiBmYWxzZVxyXG4gICAgfTtcclxuICB9O1xyXG59XHJcblxyXG5sZXQgZGIgPSBuZXcgRGF0YWJhc2UoJ2RhdGFiYXNlMScpO1xyXG5jb25zdCB1c2VyID0gbmV3IFJlZ2lzdHJhdGlvbigpO1xyXG5cclxuaWYgKHVzZXJuYW1lSW5wdXQpIHVzZXJuYW1lSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsICgpID0+IHsgdmFsaWRhdGVGaWVsZCh1c2VybmFtZUlucHV0KSB9KTtcclxuaWYgKHBhc3N3b3JkSW5wdXQpIHBhc3N3b3JkSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsICgpID0+IHsgdmFsaWRhdGVGaWVsZChwYXNzd29yZElucHV0KSB9KTtcclxuaWYgKGNvbmZpcm1Qd0lucHV0KSBjb25maXJtUHdJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgKCkgPT4geyB2YWxpZGF0ZUZpZWxkKGNvbmZpcm1Qd0lucHV0KSB9KTtcclxuaWYgKGVtYWlsSW5wdXQpIGVtYWlsSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsICgpID0+IHsgdmFsaWRhdGVGaWVsZChlbWFpbElucHV0KSB9KTtcclxuXHJcbmlmIChmb3JtKSB7XHJcbiAgZm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCAoZXZlbnQpID0+IHtcclxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgZGIuYWRkVXNlcih1c2VyLnN1Ym1pdEZvcm0oKSBhcyBJVXNlcilcclxuICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goKTtcclxuXHJcbiAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNoZWNrQWxsRmllbGRzKCkge1xyXG4gIGlmICh1c2VyLnZhbGlkYXRlRm9ybSgpKSB7XHJcbiAgICBzdWJtaXRCdXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgIHBhc3N3b3JkTWF0Y2hQYXJhZ3JhcGguc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICB9IGVsc2Uge1xyXG4gICAgc3VibWl0QnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcclxuICAgIGlmICh1c2VyLmNoZWNrUGFzc3dvcmRNYXRjaCgpKSB7XHJcbiAgICAgIHBhc3N3b3JkTWF0Y2hQYXJhZ3JhcGguc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHBhc3N3b3JkTWF0Y2hQYXJhZ3JhcGguc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiB2YWxpZGF0ZUZpZWxkKGVsZW06IEhUTUxJbnB1dEVsZW1lbnQpIHtcclxuICBsZXQgdmFsaWQ6IEJvb2xlYW4gPSB1c2VyLnZhbGlkYXRlSW5wdXQoZWxlbS5pZCwgZWxlbS52YWx1ZSk7XHJcbiAgdHJ5IHtcclxuICAgIGlmICghdmFsaWQpIHRocm93IFwiSW52YWxpZCBJbnB1dFwiO1xyXG4gIH1cclxuICBjYXRjaCAoZXJyKSB7XHJcbiAgICBlbGVtLmNsYXNzTmFtZSA9IFwiZm9ybS1jb250cm9sIGlzLWludmFsaWRcIjtcclxuICB9XHJcbiAgZmluYWxseSB7XHJcbiAgICBpZiAoZWxlbS5pZCA9PT0gJ3VzZXJuYW1lJykgdmFsaWQgPyAodXNlci51c2VybmFtZSA9IGVsZW0udmFsdWUpIDogKHVzZXIudXNlcm5hbWUgPSAnJyk7XHJcbiAgICBlbHNlIGlmIChlbGVtLmlkID09PSAncGFzc3dvcmQnKSB2YWxpZCA/ICh1c2VyLnBhc3N3b3JkID0gZWxlbS52YWx1ZSkgOiAodXNlci5wYXNzd29yZCA9ICcnKTtcclxuICAgIGVsc2UgaWYgKGVsZW0uaWQgPT09ICdjb25maXJtZWQnKSB2YWxpZCA/ICh1c2VyLmNvbmZpcm1lZCA9IGVsZW0udmFsdWUpIDogKHVzZXIuY29uZmlybWVkID0gJycpO1xyXG4gICAgZWxzZSBpZiAoZWxlbS5pZCA9PT0gJ2VtYWlsJykgdmFsaWQgPyAodXNlci5lbWFpbCA9IGVsZW0udmFsdWUpIDogKHVzZXIuZW1haWwgPSAnJyk7XHJcblxyXG4gICAgaWYgKHZhbGlkKSBlbGVtLmNsYXNzTmFtZSA9IFwiZm9ybS1jb250cm9sIGlzLXZhbGlkXCI7XHJcblxyXG4gICAgY2hlY2tBbGxGaWVsZHMoKTtcclxuICB9XHJcbn1cclxuIl0sInNvdXJjZVJvb3QiOiIifQ==